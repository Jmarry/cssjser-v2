/*
 * CssJserBlog
 * v0.0.1
 * 2014-04-22
 **/
define(["utils/notification","utils/regExps","utils/dropdown"],function(a){var b=(a("utils/dropdown"),a("utils/notification")),c=a("jquery"),d=a("utils/regExps"),e=new b.Message,f=c("#setting-general");f.on("submit",function(){return!1}),c(document).on("click",".button-save",function(){var a=f.find("#site-domain").val(),g=f.find("#site-port").val(),h={host:f.find("#site-db-host").val(),port:f.find("#site-db-port").val(),database:f.find("#site-db-database").val(),user:f.find("#site-db-user").val(),pass:f.find("#site-db-password").val()},i={ACCESS_KEY:f.find("#site-qiniu-ACCESS_KEY").val(),SECRET_KEY:f.find("#site-qiniu-SECRET_KEY").val(),bucketName:f.find("#site-qiniu-bucketName").val()};return d.url.test(a)?(c.ajax({url:"/api/basicSite/update",type:"post",dataType:"json",data:{domain:a,port:g,db:h,qiNiu:i},headers:{"X-CSRF-Token":c("meta[name='csrf-param']").attr("content")},success:function(a){a.success&&e.show({type:b.MessageTypes.success,info:"保存成功"})},error:function(a){var d="";try{d=c.parseJSON(a.response).error}catch(f){d=a}e.show({type:b.MessageTypes.error,info:d})}}),!1):(e.show({type:b.MessageTypes.error,info:"站点域名格式不正确"}),!1)})});