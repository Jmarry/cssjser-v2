/*
 * CssJserBlog
 * v0.0.1
 * 2014-04-22
 **/
define(["utils/notification","utils/regExps","utils/dropdown"],function(a){var b=(a("utils/dropdown"),a("utils/notification")),c=a("jquery"),d=a("utils/regExps"),e=new b.Message,f=c("#setting-general");f.on("submit",function(){return!1}),c(document).on("click",".button-save",function(){var a=f.find("#user-name").val(),g=f.find("#user-email").val();return d.email.test(g)?(c.ajax({url:"/api/user/update",type:"post",dataType:"json",data:{user:{name:a,email:g}},headers:{"X-CSRF-Token":c("meta[name='csrf-param']").attr("content")},success:function(a){a.success&&e.show({type:b.MessageTypes.success,info:"保存成功"})},error:function(a){var d="";try{d=c.parseJSON(a.response).error}catch(f){d=a}e.show({type:b.MessageTypes.error,info:d})}}),!1):(e.show({type:b.MessageTypes.error,info:"邮箱格式不正确"}),!1)}),c(document).on("click",".button-change-pwd",function(){var a=c.trim(f.find("#old-pwd").val()),d=c.trim(f.find("#new-pwd").val()),g=c.trim(f.find("#verify-pwd").val());return a?d&&g?d!==g?(e.show({type:b.MessageTypes.error,info:"新密码输入不一致"}),!1):(c.ajax({url:"/api/user/changePassword",type:"post",dataType:"json",data:{pwd:{old:a,"new":d}},headers:{"X-CSRF-Token":c("meta[name='csrf-param']").attr("content")},success:function(a){a.success&&e.show({type:b.MessageTypes.success,info:"保存成功"})},error:function(a){var d="";try{d=c.parseJSON(a.response).error}catch(f){d=a}e.show({type:b.MessageTypes.error,info:d})}}),!1):(e.show({type:b.MessageTypes.error,info:"新密码不能为空"}),!1):(e.show({type:b.MessageTypes.error,info:"请输入密码"}),!1)})});