/*
 * CssJserBlog
 * v0.0.1
 * 2014-04-22
 **/
define(["utils/dropdown","utils/moment","utils/regExps"],function(a){function b(a){e.ajax({url:"/api/image/getAll/",data:a||{},dataType:"json",success:function(a){var b=a.list,k=e("<div></div>");d=a.marker,e.each(b,function(a,b){var d="";(g.imageUrl.test(b.key)||b.mimeType.indexOf("image")>-1)&&(d=e(j.replace("@double_key",b.key).replace("@key",b.key).replace("@size",c(b.fsize/1e3)).replace("@time",f(parseInt(b.putTime/1e4)).format("YYYY/MM/DD hh:mm"))),k.append(d))}),h.append(k.html()),b&&b.length<30&&(i.off("click"),i.hide())}})}function c(a){return a=Math.round(10*parseFloat(a))/10,a.toString().indexOf(".")<0&&(a=a.toString()+".0"),a}{var d,e=(a("utils/dropdown"),a("jquery")),f=a("utils/moment"),g=a("utils/regExps"),h=e("#J_imgList"),i=e("#J_drop_more"),j='<li class="img-content"><a class="img-file" href="http://cssjser.qiniudn.com/@double_key" target="_blank"><img src="http://cssjser.qiniudn.com/@key?imageView2/2/w/110/h/110"/><div class="img-info"><p class="img-size">@sizeKB</p><p class="post-time">@time</p></div></a></li>';new Dropzone("#drop-area",{method:"post",maxFiles:10,maxFilesize:2,addRemoveLinks:!0,acceptedFiles:"image/*",init:function(){this.on("sending",function(a,b,c){c.append("key",(new Date).getTime()+"-"+a.name)}),this.on("success",function(a,b){e(a._removeLink).click(),e(j.replace("@double_key",b.key).replace("@key",b.key).replace("@size",c(b.size/1e3)).replace("@time","刚刚")).prependTo(h)})}})}i.on("click",function(){b({marker:d})}),b()});