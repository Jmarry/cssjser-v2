/*
 * CssJserBlog
 * v0.0.1
 * 2014-04-22
 **/
define(["jquery"],function(a){var b=a("jquery");b.autocomplete=function(a,c,d){var e={url:!1,apply:function(a){g.val(a)}},f=this;f.settings={};var g=b(a),a=a;f.init=function(){f.settings=b.extend({},e,d),f.input=g,f.ignore=[],f.data={},f.open=!1,f.load(),f.blocker=b('<div class="autocomplete-blocker"></div>').css({position:"fixed",top:0,left:0,right:0,bottom:0,"z-index":1999}).hide(),f.box=b('<div class="autocomplete"></div>').css("z-index",2e3),f.ul=b("<ul></ul>"),f.blocker.click(function(a){f.kill(),f.input.focus(),a.stopPropagation()}),g.keyup(function(a){switch(f.pos=f.selection(),a.keyCode){case 13:f.apply();case 27:f.kill();case 38:case 40:return!1;case 39:var c=f.value();c.length>0&&f.pos==f.input.val().length&&f.apply();break;case 188:f.apply();default:f.complete(b(this).val())}}),g.keydown(function(a){switch(f.pos=f.selection(),a.keyCode){case 9:return f.value().length>0?(f.apply(),!1):!0;case 38:return f.prev(),!1;case 40:return f.next(),!1}}),f.box.click(function(a){a.stopPropagation()}),b("body").append(f.box),b("body").append(f.blocker),b(window).resize(f.position),f.position()},f.load=function(){"object"==typeof c?f.data=c:b.getJSON(c,function(a){f.data=a})},f.complete=function(a){f.kill(),f.position();var c=0,a=b.trim(a);if(0==a.length)return!1;var d=new RegExp("^"+a,"i"),e=f.data.filter(function(a){return-1==f.ignore.indexOf(a)&&a.match(d)?a:void 0});e=e.slice(0,5),b.each(e,function(a,d){var e=b("<li>"+d+"</li>");e.click(function(){f.apply(d)}),e.mouseover(function(){f.ul.find(".selected").removeClass("selected"),e.addClass("over")}),e.mouseout(function(){e.removeClass("over")}),f.ul.append(e),0==c&&e.addClass("first selected"),c++}),c>0&&(f.box.append(f.ul.show()),f.blocker.show(),f.open=!0)},f.kill=function(){f.blocker.hide(),f.ul.empty().hide(),f.open=!1},f.apply=function(a){if(!a)var a=f.value();f.settings.apply.call(f,a)},f.value=function(){return f.selected().text()},f.selected=function(){return f.ul.find(".selected")},f.select=function(a){f.deselect(),a.addClass("selected")},f.deselect=function(){f.selected().removeClass("selected")},f.prev=function(){var a=f.selected(),b=a.prev();b.length>0&&f.select(b)},f.next=function(){var a=f.selected(),b=a.length>0?a.next():f.ul.find("li:first-child");b.length>0&&f.select(b)},f.selection=function(){var a=f.input[0],b=f.val;if(!a.createTextRange)return a.selectionStart;var c=document.selection.createRange().duplicate();return c.moveEnd("character",b.length),""==c.text?b.length:b.lastIndexOf(c.text)},f.position=function(){var a=g.offset(),b=g.height();a.top=a.top+b+10,f.box.css(a)},f.init()},b.fn.autocomplete=function(a,c){return this.each(function(){if(void 0==b(this).data("autocomplete")){var d=new b.autocomplete(this,a,c);b(this).data("autocomplete",d)}})},b.tagbox=function(a,c){var d={url:!1,autocomplete:{},lowercase:!0,classname:"tagbox",separator:", ",duplicates:!1,minLength:1,maxLength:140,keydown:function(){},onAdd:function(){},onRemove:function(){},onDuplicate:function(){return e.input.focus()},onInvalid:function(){return e.input.focus()},onReady:function(){}},e=this;e.settings={};var f=b(a),a=a;e.init=function(){e.settings=b.extend({},d,c);var a=(f.attr("name"),f.attr("id"),f.val());if(e.index=[],e.val="",e.focused=!1,e.origin=f.addClass("tagboxified").hide(),e.box=b('<div class="'+e.settings.classname+'"><ul><li class="new"><input autocomplete="off" tabindex="0" type="text" /></li></ul></div>'),e.input=e.box.find("input").css("width",20),e.bhits=0,e.lhits=0,e.settings.url){var g={apply:function(a){e.add(a),this.kill(),e.input.focus()}};e.input.autocomplete(e.settings.url,b.extend({},g,e.settings.autocomplete)),e.autocomplete=e.input.data("autocomplete"),e.settings.onAdd=function(){e.autocomplete.ignore=e.serialize()},e.settings.onRemove=function(){e.autocomplete.ignore=e.serialize()}}e.origin.before(e.box),e.measure=b('<div style="display: inline" />').css({"font-size":e.input.css("font-size"),"font-family":e.input.css("font-family"),visibility:"hidden",position:"absolute",top:-1e4,left:-1e4}),b("body").append(e.measure),e.box.click(function(a){e.focus(),e.input.focus(),a.stopPropagation()}),e.input.keydown(function(a){e.val=e.input.val(),e.position=e.selection(),e.settings.keydown.call(e,a,e.val)}),e.input.keyup(function(){e.val=e.input.val(),e.position=e.selection(),e.resize(e.val),e.val.match(new RegExp(e.settings.separator))&&e.add(e.val)}),e.input.focus(function(){e.input.focused=!0,e.deselect(),e.bhits=0,e.focus()}),e.input.blur(function(){e.input.focused=!1,e.bhits=0,0==e.val.length&&e.blur()}),e.settings.onReady.call(this),b(document).keydown(function(a){if(!e.focused)return!0;switch(a.keyCode){case 8:if(!e.input.focused)return e.remove(),!1;if(0==e.val.length)return e.next(),!1;if(0==e.position){if(e.bhits>0)return e.bhits=0,e.next(),!1;e.bhits++}break;case 37:if(!e.input.focused)return e.previous();if(0==e.val.length)return e.next(),!1;if(0==e.position){if(e.lhits>0)return e.lhits=0,e.next(),!1;e.lhits++}break;case 39:if(!e.input.focused)return e.next(),!1;break;case 9:if(e.input.focused&&e.val.length>e.settings.minLength)return e.add(e.val),!1;if(e.selected().length>0)return e.deselect(),e.input.focus(),!1;break;case 13:case 188:if(e.input.focused)return e.settings.autocomplete||e.add(e.val),!1}}).click(function(){e.val.length>0&&e.add(e.val)}),a.length>0&&e.add(a)},e.resize=function(a){e.measure.text(a),e.input.css("width",e.measure.width()+20)},e.focus=function(a){if(e.focused)return!0;if(b(".tagboxified").not(e.origin).each(function(){b(this).data("tagbox")&&b(this).data("tagbox").blur()}),e.box.addClass("focus"),e.focused=!0,void 0==a)var a=!0;a!==!1&&e.input.focus()},e.blur=function(){return e.focused?(e.box.removeClass("focus"),e.focused=!1,e.input.blur(),void e.deselect()):!0},e.tag=function(a){return a=a.replace(/,/g,"").replace(/;/g,""),e.settings.lowercase&&(a=a.toLowerCase()),b.trim(a)},e.serialize=function(){return e.index},e.string=function(){return e.serialize().toString()},e.add=function(a){if(e.input.val(""),!a&&e.val.length>0)return e.add(e.val);if(!a)return!0;if(b.isArray(a)||a.match(new RegExp(e.settings.separator))){var c=b.isArray(a)?a:a.split(e.settings.separator);return b.each(c,function(a,b){e.add(b)}),!0}var a=e.tag(a);if(a.length<e.settings.minLength||a.length>e.settings.maxLength)return e.settings.onInvalid.call(e,a,length);if(0==e.settings.duplicates&&b.inArray(a,e.index)>-1)return e.settings.onDuplicate.call(e,a);e.index.push(a);var d=b('<li><span class="tag"></span><span class="delete">&#215;</span></li>').data("tag",a);d.find(".tag").text(a),d.find(".delete").click(function(){e.remove(d)}),d.click(function(a){e.blur(),a.stopPropagation(),e.select(d)}),d.focus(function(){e.select(d)}),e.input.parent().before(d),e.input.val(""),e.input.css("width",20);var f=e.serialize();e.origin.val(f.join(e.settings.separator)),e.settings.onAdd.call(e,a,f,d)},e.select=function(a){if("string"==typeof a){var a=e.find(a);if(!a)return!1}return 0==a.length?!1:(e.input.blur(),this.deselect(),a.addClass("selected"),void e.focus(!1))},e.selected=function(){return e.box.find(".selected")},e.deselect=function(){var a=e.selected();a.removeClass("selected")},e.find=function(a){var c=!1;return e.box.find("li").not(".new").each(function(){b(this).data("tag")==a&&(c=b(this))}),c},e.remove=function(a){if(e.input.val(""),"string"==typeof a){var a=e.find(a);if(!a)return!1}var b=e.selected();if(!a&&b.length>0)var a=b.first();var c=e.previous(!0);0==c.length?e.next():e.select(c);var d=a.find(".tag").text();e.removeFromIndex(d),a.remove();var f=e.serialize();e.origin.val(f),e.settings.onRemove.call(e,d,f,a)},e.removeFromIndex=function(a){var b=e.index.indexOf(a);e.index.splice(b,1)},e.selection=function(){var a=e.input[0],b=e.val;if(!a.createTextRange)return a.selectionStart;var c=document.selection.createRange().duplicate();return c.moveEnd("character",b.length),""==c.text?b.length:b.lastIndexOf(c.text)},e.previous=function(a){var b=e.selected(),c=0==b.length?e.box.find("li").not(".new").first():b.prev().not(".new");return a?c:e.select(c)},e.next=function(a){var b=e.selected(),c=0==b.length?e.box.find("li").not(".new").last():b.next();return a?c:c.hasClass("new")?e.input.focus():e.select(c)},e.init()},b.fn.tagbox=function(a){return this.each(function(){if(void 0==b(this).data("tagbox")){var c=new b.tagbox(this,a);b(this).data("tagbox",c)}})}});